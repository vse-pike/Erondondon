<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Erondondon.com</title>
</head>
<body>
<div>
    Введите логин:<br/>
    <input id="userName" type="text"/><br/><br/>
    Введите сообщение: <br/>
    <input id="message" type="text"/>
    <input id="sendBtn" type="button" value="Отправить" disabled="disabled"/>
</div>
<div id="chatroom"></div>
<script src="./node_modules/@microsoft/signalr/dist/browser/signalr.min.js"></script>
<script>
    const hubConnection = new signalR.HubConnectionBuilder()
        .withUrl("/chat")
        .build();

    document.getElementById("sendBtn").addEventListener("click", () => {
        let userName = document.getElementById("userName").value;
        let message = document.getElementById("message").value;

        hubConnection.invoke("Send", message, userName)
            .catch((err) => {
                console.error(err.toString());
            });
    });

    hubConnection.on("Receive", (message, userName) => {
        const userNameEl = document.createElement("b");
        userNameEl.textContent = `${userName}: `;
        
        const messageEl = document.createElement("p");
        messageEl.appendChild(userNameEl);
        messageEl.appendChild(document.createTextNode(message));
        
        const firstEl = document.getElementById("chatroom").firstChild;
        document.getElementById("chatroom").insertBefore(messageEl, firstEl);
    });

    hubConnection.start()
        .then(() => {
            document.getElementById("sendBtn").disabled = false;
        })
        .catch((err) => {
            console.error(err.toString());
        });
</script>
</body>
</html>